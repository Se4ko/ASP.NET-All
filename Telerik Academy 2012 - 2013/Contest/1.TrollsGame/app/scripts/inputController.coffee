# We inject dependency this way, so they work with minification
GAME.controller 'inputController', [
   '$scope', '$timeout', '$log', 'workerService'
  ( $scope ,  $timeout ,  $log ,  workerService ) ->

    $scope.callWorker = ->
        return unless $scope.input.$valid
        $scope.state = 'calculating'
        $timeout ->
            workerService.fire $scope.field, $scope.moves
        , 250 # Show loading status on small input

    $scope.n = workerService.inputField?.length || 30

    $scope.field = workerService.inputField || [
        [ 1, 2, 3, 4,22, 2, 3,18,20,26, 9,28, 5, 6, 0,10,11, 2,25,18,28,10,27,14,13,12,13,29, 9,10]
        [ 5, 6, 7, 8,29,24,29,25, 1,22,26, 5,22, 5,22, 3, 0,17,16,18, 6, 7,18,11, 8,21, 3,22, 8, 9]
        [ 9, 1, 8, 7,17,24,22, 3,21,18, 7,26,15,25,21,16,28, 7,21,26, 1,23,17,11, 0, 7, 3,10,17,20]
        [ 1, 2, 3, 4,16,14,20,13,17, 6, 0,23, 0,22,22,25,26,11, 4, 5,10, 2, 6,10,10, 2,26, 7,27, 2]
        [10, 4,16,15, 5,29,20,26,14,11,29, 8, 4,27,29,16, 4,29,21,14,12, 7, 6,20,25, 5,18, 0,26, 1]
        [24,22,16,14, 7, 2, 4,17,11,27,13,28,11,24,26,25, 3,28,14,14,14, 3,13,11,13,28,13,22, 1, 1]
        [10,17, 3,10, 1,15, 7,20,27,13,17,29, 1,13,16,13, 5,28,24, 2,20, 6, 1,23,11,18,19, 5, 6,14]
        [15,28,25,24,12,27,13,15,15,19,23,18, 2, 0,19,25,18,29,29,12,27, 4,20,27,27, 1, 2,19, 5, 0]
        [12,17,21,13, 8,29, 1,13,17,24,27,28,16, 9,11,23,11,27,16,14, 5,18, 5,29, 6,19, 9, 8,25,15]
        [20,25,19,19,23,27,28,10,20,26,15,15, 9,14, 8,23, 7,25,15,16,22, 0,14, 2, 1, 8,28, 2,27, 9]
        [26,20,10,21,18,24, 3, 9, 9,28,27, 3,14, 6, 1,14, 7, 2,26, 1,15, 6,22,25,24,15, 4, 0, 3,15]
        [ 3,23,25, 3,20, 4, 5,25,15, 8,25,17, 1,16, 0,26, 5, 2,22,16,12,12,12,25,20,11,28, 9, 0,23]
        [23, 3, 1,22,22,21,21, 1,12,27,17,18,19,18,16, 2,27, 4,27, 9,18,19,20,23,12, 2,17,25, 6, 9]
        [24, 6,17,11,16, 5,26,14,27,26,27, 4,13, 1,22,21, 0,25,21,14,25,28, 9,27, 5,10, 3, 1, 6,21]
        [22, 9,14,27,22,24,25,21,18,27,16, 2,26,29, 6, 9,26, 6,26, 8,10, 3,20, 2,28, 6,28,26,18, 7]
        [28, 5, 8,26, 9,27,17,25, 0, 3, 3, 7,14,11, 5,21,20,29,24, 6,17, 9,19,17,27, 1,20,25,26,28]
        [10,21, 4,27,10,18,21, 0,19,20,29, 5, 2, 7, 7,18, 7,12,29, 3,14,22,26, 2,25,10, 6,20,22,20]
        [22, 7,21, 3, 5, 7,20,29,27,19,28, 6,13,21,27,22,12,10,16, 2,26,24,14,15,11,26, 6,15,12,12]
        [16,23,16,28,12,20, 9, 6,20,23,15,10, 8,24, 0,23,11, 0,10,26,13, 7,17,24,17,16,13, 1, 2, 6]
        [ 2, 6,29,10,25,26,23,11,27,29, 8,28,10, 1,29,14,14,13,26,22,28,23,14,29,16,22,28,16, 0,25]
        [ 8, 1,12,28,11, 0, 7,28,17,28,21,16,19,20,28, 0,23,17,20,10, 2,17, 9,13,22,23, 2, 9,12,27]
        [ 9, 0,21, 1,15, 3,27, 0,13,25,19,27,21, 0,26, 5, 2,24,17,18,10,23,23,18,10,12, 9,25,13, 5]
        [26,12,26, 3, 8,18, 8,29, 1,22,18,21,24,14,15,12,20,29, 3, 8,11,23,19,19,23, 7,29,19,24,18]
        [ 8,28, 0,26,22,20,16,17,16, 8,26, 4,17,11,29,14,17,10,10,20,10,17,19, 0,24,27,28, 3,12, 1]
        [ 7, 6, 9, 1,10,11,19,16,11,20,13,22,27, 1,29,23, 4,26,26,17,15, 1,10,14,15, 3,20,14,26, 1]
        [13, 7,10, 4,22,16, 9, 4,11,10, 6, 6, 2, 7,18,26,12, 7, 2,29,29,11,14, 0,12,26,27,11,10,18]
        [13,21, 1, 2,19, 3, 7,26,22, 7,13, 2, 0, 5, 2,10, 3,22,18, 7, 2, 6,15, 4,14, 1, 5,23,22,22]
        [14,26,26,20, 4,15,27,25,23,18,22, 7, 7, 2,26, 4,13,28,24,10, 0, 6, 6,13,28,27,11,15,11,22]
        [27, 2,22, 3,20,11, 9, 3,17, 5, 0, 6,16,24, 8,19, 4,13,25,25, 4,20,10, 0,26,29,12,23, 1,12]
        [20, 2, 5, 3, 2,21,23, 0,20, 5,28,23, 7,16, 6, 1, 5,11,17, 3, 4, 4,11, 6,15, 5, 7,29,12,18]
    ]

    $scope.moves = workerService.inputMoves || [
        ['put' ,  2,  3]
        ['take',  3,  1]
        ['take', 23,  7]
        ['put' ,  2, 14]
        ['take',  0, 14]
        ['take',  0, 29]
        ['put' , 13,  9]
    ]
]
